class Status extends React.Component{render(){return React.createElement("section",{class:"panel statusControls"},React.createElement("h2",null,"MISSION STATUS"),React.createElement(ProgressUI,{totalMines:this.props.totalMines,flagCount:this.props.flagCount,safeTilesRemaining:this.props.safeTilesRemaining}),React.createElement("section",{class:"controls"},React.createElement(MenuToggle,{toggleMenuMode:this.props.toggleMenuMode,isMenuMode:this.props.isMenuMode}),React.createElement(ResetGame,{reset:this.props.reset})))}}class ProgressUI extends React.Component{render(){var e=this.props.flagCount>this.props.totalMines;return React.createElement("section",{class:"progress"},React.createElement("p",null,React.createElement("span",{class:"label"},"mines (flagged/total)"),React.createElement("span",{class:"value"+(e?" error":"")},this.props.flagCount,"/",this.props.totalMines)),React.createElement("p",null,React.createElement("span",{class:"label"},"safe tiles remaining"),React.createElement("span",{class:"value"},this.props.safeTilesRemaining)))}}class MenuToggle extends React.Component{render(){return React.createElement("div",{class:"labelledToggle"},React.createElement("label",null,"input mode"),React.createElement("button",{class:"toggle",onClick:this.props.toggleMenuMode},React.createElement(ToggleOption,{displayText:"mouse",isActive:!this.props.isMenuMode}),React.createElement(ToggleOption,{displayText:"menu",isActive:this.props.isMenuMode})))}}class ToggleOption extends React.Component{render(){return React.createElement("span",{class:this.props.isActive?"toggleActive":"toggleInactive"},this.props.displayText)}}class ResetGame extends React.Component{render(){return React.createElement("button",{class:"btn",id:"reset_btn_id",onClick:this.props.reset},"reset")}}class Display{static hidden=new Display("hidden");static empty=new Display("empty");static number=new Display("number");static mine=new Display("mine");static flag=new Display("flag");constructor(e){this.name=e}toString(){return"Display."+this.name}}class BoardSection extends React.Component{constructor(e){super(e),this.updateBoard=this.updateBoard.bind(this),this.getAdjRowRange=this.getAdjRowRange.bind(this),this.getAdjColRange=this.getAdjColumnRange.bind(this),this.getNumAdjacent=this.getNumAdjacentMines.bind(this),this.unhideTile=this.unhideTile.bind(this),this.toggleFlag=this.toggleFlag.bind(this),this.openMenu=this.openMenu.bind(this),this.closeMenu=this.closeMenu.bind(this),this.setKeyboardMode=this.setKeyboardMode.bind(this),this.getTileEle=this.getTileEle.bind(this),this.state={newboard:this.newBoard.bind(this),gameId:null,board:this.newBoard(e.numRows,e.numCols,e.numMines),explodedTile:null,menuIsOpen:!1,menuRowId:null,menuColId:null,menuPos:null,isKeyboardMode:null}}static getDerivedStateFromProps(e,t){if(null===t.gameId||t.gameId!==e.gameId)return{...t,gameId:e.gameId,board:t.newboard(e.numRows,e.numCols,e.numMines),explodedTile:null,menuPos:null}}newBoard(e,t,s){for(var i=[],n=this.sample(e*t,s),a=0;a<e;a++){for(var l=[],o=0;o<t;o++){var r=n.includes(a*t+o);l.push({isMine:r,displayStatus:Display.hidden,numAdjacentMines:null})}i.push(l)}return i}sample(e,t){for(var s=[];0<t;){var i=Math.floor(Math.random()*e);s.includes(i)||(s.push(i),t--)}return s.sort((e,t)=>e-t)}updateBoard(i,n,a){this.setState(e=>({...e,board:e.board.map((e,s)=>e.map((e,t)=>s!==i||t!==n?e:a))}))}openMenu(t,s,i,n){this.setState(e=>({...e,menuIsOpen:!0,menuRowId:t,menuColId:s,menuPos:{x:i,y:n}}))}closeMenu(){this.setState(e=>({...e,menuIsOpen:!1,menuRowId:null,menuColId:null,menuPos:null}))}setKeyboardMode(t){this.setState(e=>({...e,isKeyboardMode:t}))}getUnhiddenTile(e,t){var s=this.state.board[e][t];return s.displayStatus!==Display.hidden?s:s.isMine?{...s,displayStatus:Display.mine}:0===(e=this.getNumAdjacentMines(e,t))?{...s,displayStatus:Display.empty}:{...s,displayStatus:Display.number,numAdjacentMines:e}}getNumAdjacentMines(e,t){let s=0;var i,n=this.getAdjRowRange(e),a=this.getAdjColRange(t);for(i in n){var l,o=n[i];for(l in a){var r=a[l];o===e&&r===t||this.state.board[o][r].isMine&&s++}}return s}getAdjRowRange(e){for(var t=e+1<this.state.board.length?e+1:this.state.board.length-1,s=[],i=0<=e-1?e-1:0;i<t+1;i++)s.push(i);return s}getAdjColumnRange(e){for(var t=e+1<this.state.board[0].length?e+1:this.state.board[0].length-1,s=[],i=0<=e-1?e-1:0;i<t+1;i++)s.push(i);return s}unhideTile(e,t,s={}){if(this.state.board[e][t].displayStatus===Display.hidden){var i=e+","+t;if(!(i in s)){s[i]=0;i=this.getUnhiddenTile(e,t);if(this.updateBoard(e,t,i),i.isMine)this.gameOverLost(e,t);else if(this.props.updateProgress(),i.displayStatus===Display.empty){var n,a=this.getAdjRowRange(e),l=this.getAdjColRange(t);for(n in a){var o,r=a[n];for(o in l){var d=l[o];r===e&&d===t||this.unhideTile(r,d,s)}}}}}}toggleFlag(e,t){var s=this.state.board[e][t];s.displayStatus!==Display.flag?(this.updateBoard(e,t,{...s,displayStatus:Display.flag}),this.props.updateFlagCounter(1)):s.displayStatus===Display.flag&&(this.updateBoard(e,t,{...s,displayStatus:Display.hidden}),this.props.updateFlagCounter(-1))}gameOverLost(t,s){this.setState(e=>({...e,explodedTile:[t,s]})),this.unhideAll(),this.props.setGameOver()}unhideAll(){for(var e=0;e<this.state.board.length;e++)for(var t,s=0;s<this.state.board[0].length;s++)this.state.board[e][s].displayStatus===Display.hidden&&(t=this.getUnhiddenTile(e,s),this.updateBoard(e,s,t))}getTileEle(e,t){return document.querySelectorAll(".tile")[e*this.state.board[0].length+t]}render(){return React.createElement("section",{class:"panel boardContainer"},React.createElement("h2",null,"ASSIGNED GRID"),React.createElement(KeyboardMode,{isMenuMode:this.props.isMenuMode,toggleMenuMode:this.props.toggleMenuMode,isKeyboardMode:this.state.isKeyboardMode,setKeyboardMode:this.setKeyboardMode}),React.createElement(TileClickMenu,{isMenuMode:this.props.isMenuMode,menuIsOpen:this.state.menuIsOpen,closeMenu:this.closeMenu,board:this.state.board,menuRowId:this.state.menuRowId,menuColId:this.state.menuColId,unhideTile:this.unhideTile,toggleFlag:this.toggleFlag,menuPos:this.state.menuPos,isKeyboardMode:this.state.isKeyboardMode,getTileEle:this.getTileEle}),React.createElement(Board,{board:this.state.board,toggleFlag:this.toggleFlag,unhideTile:this.unhideTile,explodedTile:this.state.explodedTile,isGameOver:this.props.isGameOver,safeTilesRemaining:this.props.safeTilesRemaining,openMenu:this.openMenu,isMenuMode:this.props.isMenuMode,saveClickCoords:this.saveClickCoords,menuRowId:this.state.menuRowId,menuColId:this.state.menuColId,getTileEle:this.getTileEle}))}}class KeyboardMode extends React.Component{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.isMenuMode||this.props.toggleMenuMode();var e=!this.props.isKeyboardMode;this.props.setKeyboardMode(e),e&&document.querySelectorAll(".tile")[0].focus()}render(){return React.createElement("button",{class:"keyboardStartGame",onClick:this.handleClick},React.createElement("span",null,"enter game"))}}class Board extends React.Component{render(){return React.createElement("div",{id:"board_id",class:"board"},this.props.board.map((e,t)=>React.createElement(BoardRow,{key:t,rowNum:t,tileRow:e,toggleFlag:this.props.toggleFlag,unhideTile:this.props.unhideTile,explodedTile:this.props.explodedTile,isGameOver:this.props.isGameOver,safeTilesRemaining:this.props.safeTilesRemaining,openMenu:this.props.openMenu,isMenuMode:this.props.isMenuMode,menuRowId:this.props.menuRowId,menuColId:this.props.menuColId,maxRow:this.props.board.length-1,maxCol:this.props.board[0].length-1,getTileEle:this.props.getTileEle})))}}class BoardRow extends React.Component{render(){return React.createElement("div",{class:"board-row"},this.props.tileRow.map((e,t)=>React.createElement(Tile,{key:t,colNum:t,rowNum:this.props.rowNum,handleClick:this.props.handleClick,display:e.displayStatus.name,adjMines:e.numAdjacentMines,isExplodedTile:null!==this.props.explodedTile&&this.props.explodedTile[0]===this.props.rowNum&&this.props.explodedTile[1]===t,isGameOver:this.props.isGameOver,isMine:e.isMine,isWon:this.props.isGameOver&&0===this.props.safeTilesRemaining,isMenuMode:this.props.isMenuMode,openMenu:this.props.openMenu,toggleFlag:this.props.toggleFlag,unhideTile:this.props.unhideTile,menuRowId:this.props.menuRowId,menuColId:this.props.menuColId,maxRow:this.props.maxRow,maxCol:this.props.maxCol,getTileEle:this.props.getTileEle})))}}class Tile extends React.Component{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.disableContextMenu=this.disableContextMenu.bind(this),this.handleKeydown=this.handleKeydown.bind(this)}handleMouseClick(e){var t;"which"in e?t=3==e.which:"button"in e&&(t=2==e.button),t?this.props.toggleFlag(this.props.rowNum,this.props.colNum):this.props.unhideTile(this.props.rowNum,this.props.colNum)}disableContextMenu(e){this.props.isGameOver||(e.preventDefault(),this.handleClick(e))}handleClick(e){var t,s;this.props.isGameOver||(this.props.isMenuMode?(s=document.getElementById("board_id").getBoundingClientRect(),t=this.getMenuPosX(e,s),s=this.getMenuPosY(e,s),this.props.openMenu(this.props.rowNum,this.props.colNum,t,s)):this.handleMouseClick(e))}getMenuPosX(e,t){return void 0!==e.clientX?(e=e.clientX-t.left,(t=(t.right-t.left)/2)<e?8+t:8+e):8}getMenuPosY(e,t){return void 0!==e.clientX?e.clientY-t.top+32:0}handleKeydown(s){if(9===s.keyCode||27===s.keyCode)s.preventDefault(),document.querySelectorAll(".keyboardStartGame")[0].focus();else if(13===s.keyCode||32===s.keyCode)s.preventDefault(),this.handleClick(s);else if(37===s.keyCode||38===s.keyCode||39===s.keyCode||40===s.keyCode){s.preventDefault();let e=this.props.rowNum,t=this.props.colNum;38===s.keyCode?--e<0&&(e=this.props.maxRow):40===s.keyCode?++e>this.props.maxRow&&(e=0):37===s.keyCode?--t<0&&(t=this.props.maxCol):39===s.keyCode&&++t>this.props.maxCol&&(t=0),this.props.getTileEle(e,t).focus()}}getCssClassMain(){return this.props.isWon&&this.props.display===Display.hidden.name?Display.flag.name:this.props.display}getCssClassFlag(){var e=this.props.display===Display.flag.name&&!this.props.isMine;return this.props.isGameOver&&e?" wrong":""}getCssClassExploded(){return this.props.isExplodedTile?" exploded":""}getCssClassMenuActive(){return this.props.menuColId===this.props.colNum&&this.props.menuRowId===this.props.rowNum?" menuActive":""}getConditionalCssClasses(){return[this.getCssClassMain(),this.getCssClassFlag(),this.getCssClassExploded(),this.getCssClassMenuActive()].join("")}render(){var e=this.getConditionalCssClasses();return React.createElement("div",{class:"tile "+e,tabindex:-1,onClick:this.handleClick,onContextMenu:this.disableContextMenu,onKeyDown:this.handleKeydown},React.createElement(TileNumberUI,{isNumber:this.props.display===Display.number.name,number:this.props.adjMines}))}}class TileNumberUI extends React.Component{render(){return this.props.isNumber?React.createElement("span",{class:"adj"+this.props.number},this.props.number):null}}class TileClickMenu extends React.Component{constructor(e){super(e),this.toggleFlag=this.toggleFlag.bind(this),this.unhideTile=this.unhideTile.bind(this),this.activeTileIsFlagged=this.activeTileIsFlagged.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.state={selectedId:1}}setSelected(t){this.setState(e=>({...e,selectedId:t}))}getActiveTile(e,t,s){return null===e||null===t?null:s[e][t]}activeTileIsFlagged(){var e=this.getActiveTile(this.props.menuRowId,this.props.menuColId,this.props.board);return null===e?null:e.displayStatus===Display.flag}toggleFlag(){this.props.toggleFlag(this.props.menuRowId,this.props.menuColId),this.closeMenu()}unhideTile(){this.props.unhideTile(this.props.menuRowId,this.props.menuColId),this.closeMenu()}closeMenu(){this.setSelected(1),this.props.getTileEle(this.props.menuRowId,this.props.menuColId).focus(),this.props.closeMenu()}getPositioningStyle(){return{top:this.props.menuPos.y+"px",left:this.props.menuPos.x+"px"}}handleKeyDown(t){if(9===t.keyCode||27===t.keyCode)t.preventDefault(),this.closeMenu();else if(38===t.keyCode||40===t.keyCode){t.preventDefault();let e=this.state.selectedId;var s=document.querySelectorAll(".menu")[0].getElementsByTagName("button"),i=s.length-1;38===t.keyCode?--e<0&&(e=i):40===t.keyCode&&++e>i&&(e=0),this.setSelected(e),s[e].focus()}}render(){var e;return this.props.isMenuMode&&this.props.menuIsOpen?(e=null!==(e=this.activeTileIsFlagged())&&e?"unflag":"flag",React.createElement("section",{class:"menu panel",style:this.getPositioningStyle(),onKeyDown:this.handleKeyDown},React.createElement("h2",null,"ACTION"),React.createElement("button",{class:"close",onClick:this.props.closeMenu},"X"),React.createElement("button",{autoFocus:!0,class:"unhideTile btn",onClick:this.unhideTile},"uncover"),React.createElement("button",{class:"toggleFlag btn",onClick:this.toggleFlag},e))):null}}class MinesweeperGame extends React.Component{constructor(e){super(e),this.updateProgress=this.updateProgress.bind(this),this.setGameOver=this.setGameOver.bind(this),this.updateFlagCounter=this.updateFlagCounter.bind(this),this.reset=this.reset.bind(this),this.toggleMenuMode=this.toggleMenuMode.bind(this),this.state={gameId:1,gameOver:!1,flagCounter:0,isMenuMode:!1,maxSafeTiles:e.numRows*e.numCols-e.numMines,safeTilesRemaining:e.numRows*e.numCols-e.numMines}}reset(){this.setState(e=>({...e,gameId:e.gameId+1,gameOver:!1,flagCounter:0,safeTilesRemaining:e.maxSafeTiles})),document.querySelectorAll(".tile")[0].focus()}updateProgress(){1===this.state.safeTilesRemaining&&this.setGameOver(),this.updateSafeTiles(-1)}setGameOver(){this.setState(e=>({...e,gameOver:!0}))}updateSafeTiles(t){this.setState(e=>({...e,safeTilesRemaining:e.safeTilesRemaining+t}))}updateFlagCounter(t){this.setState(e=>({...e,flagCounter:e.flagCounter+t}))}toggleMenuMode(){this.setState(e=>({...e,isMenuMode:!e.isMenuMode}))}render(){return React.createElement("div",{class:"minesweeper"},React.createElement("h1",null,"MINESWEEPER"),React.createElement(Status,{totalMines:this.props.numMines,flagCount:this.state.flagCounter,safeTilesRemaining:this.state.safeTilesRemaining,reset:this.reset,isMenuMode:this.state.isMenuMode,toggleMenuMode:this.toggleMenuMode}),React.createElement(BoardSection,{numRows:this.props.numRows,numCols:this.props.numCols,numMines:this.props.numMines,gameId:this.state.gameId,updateProgress:this.updateProgress,updateFlagCounter:this.updateFlagCounter,setGameOver:this.setGameOver,isGameOver:this.state.gameOver,safeTilesRemaining:this.state.safeTilesRemaining,isMenuMode:this.state.isMenuMode,toggleMenuMode:this.toggleMenuMode}),React.createElement(Result,{safeTilesRemaining:this.state.safeTilesRemaining,isGameOver:this.state.gameOver,gameId:this.state.gameId}))}}class Result extends React.Component{constructor(e){super(e),this.handleOverlayClose=this.handleOverlayClose.bind(this),this.state={wantOverlay:!0,gameId:null}}static getDerivedStateFromProps(e,t){if(null===t.gameId||t.gameId!==e.gameId)return{...t,wantOverlay:!0,gameId:e.gameId}}removeOverlay(){this.setState(e=>({...e,wantOverlay:!1}))}handleOverlayClose(){document.getElementById("reset_btn_id").focus(),this.removeOverlay()}closeOverlayButton(){return React.createElement("button",{autoFocus:!0,class:"close",onClick:this.handleOverlayClose},String.fromCharCode(8211))}getOverlayPositionStyle(){var e;return this.state.wantOverlay?{top:(e=document.getElementById("board_id").getBoundingClientRect()).top+Math.round((e.bottom-e.top)/4)+"px"}:null}render(){var e;return this.props.isGameOver?(e=0===this.props.safeTilesRemaining,this.state.wantOverlay?React.createElement("div",{class:"overlayWrapper",style:this.getOverlayPositionStyle()},React.createElement(ResultPanel,{closeOverlayButton:this.closeOverlayButton(),won:e})):React.createElement(ResultPanel,{closeOverlayButton:null,won:e})):null}}class ResultPanel extends React.Component{render(){var e=this.props.won?"success":"failure",t=this.props.won?"lives saved: incalculable. congratulations++":"explosions chaining. all hope lost. goodb-";return React.createElement("section",{class:"panel result"},React.createElement("h2",null,"MISSION RESULT"),this.props.closeOverlayButton,React.createElement("h3",null,e.toUpperCase()),React.createElement("p",null,t))}}ReactDOM.render(React.createElement(MinesweeperGame,{numRows:10,numCols:10,numMines:10}),document.querySelector(".root"));